# üõí Template Sistema de Checkout - Deploy com Rollback Autom√°tico
# 
# Otimizado para sistemas de checkout e finaliza√ß√£o de compras
# Configura√ß√µes balanceadas para alta disponibilidade

name: Deploy Sistema Checkout

on:
  push:
    branches: [main, master]
  workflow_dispatch:

jobs:
  deploy:
    uses: SeuUsuario/vercel-rollback-workflows/.github/workflows/vercel-rollback.yml@v1.0.0
    with:
      # ‚¨áÔ∏è OBRIGAT√ìRIO: Nome do seu projeto no Vercel
      vercelProject: "checkout-sistema-prod"
      
      # ‚¨áÔ∏è ROTAS CR√çTICAS PARA SISTEMA DE CHECKOUT
      routes: "/,/carrinho,/checkout,/pagamento,/api/cart,/api/payment,/api/shipping,/api/cep,/api/health"
      
      # ‚¨áÔ∏è CONFIGURA√á√ïES PARA ALTA DISPONIBILIDADE
      healthCheckTimeout: 50        # Timeout m√©dio-alto para checkout
      maxRetries: 4                 # Bom n√∫mero de tentativas
      enablePostDeployMonitoring: true
      monitoringDurationMinutes: 45 # Monitoramento robusto
      monitoringIntervalMinutes: 4  # Verifica√ß√µes regulares
      
    secrets:
      VERCEL_TOKEN: ${{ secrets.VERCEL_TOKEN }}
      VERCEL_TEAM_ID: ${{ secrets.VERCEL_TEAM_ID }}
      VERCEL_SCOPE: ${{ secrets.VERCEL_SCOPE }}

# ========================================
# ROTAS IMPORTANTES PARA SISTEMA DE CHECKOUT
# ========================================
#
# P√°ginas Cr√≠ticas:
# / - Landing page do checkout
# /carrinho - Carrinho de compras
# /checkout - Processo de finaliza√ß√£o (CR√çTICO)
# /pagamento - Processamento de pagamento (CR√çTICO)
# /confirmacao - Confirma√ß√£o de pedido
# /rastreamento - Acompanhamento do pedido
#
# APIs Cr√≠ticas:
# /api/cart - Opera√ß√µes do carrinho (CR√çTICO)
# /api/payment - Processamento de pagamentos (CR√çTICO)
# /api/shipping - C√°lculo de frete (CR√çTICO)
# /api/cep - Busca de endere√ßo
# /api/cupom - Sistema de cupons
# /api/health - Health check
#
# APIs de Integra√ß√£o:
# /api/webhook/payment - Webhooks de pagamento
# /api/webhook/shipping - Webhooks de entrega
#
# ========================================
# CONFIGURA√á√ïES ESPEC√çFICAS
# ========================================
#
# BALANCEADO para sistemas de checkout:
# - Timeout m√©dio-alto (50s) para opera√ß√µes de checkout
# - Tentativas suficientes (4) para lidar com integra√ß√µes
# - Monitoramento robusto (45min) para detectar problemas
# - Verifica√ß√µes regulares (4min) para boa cobertura
#
# FOCO: Garantir que o processo de checkout nunca falhe
# sem detec√ß√£o, pois impacta diretamente na receita.
#
# ========================================
