# üí≥ Template Gateway de Pagamento - Deploy com Rollback Autom√°tico
# 
# Configura√ß√£o ultra-robusta para sistemas de pagamento
# M√°xima confiabilidade e monitoramento estendido

name: Deploy Gateway Pagamento

on:
  push:
    branches: [main, master]
  workflow_dispatch:

jobs:
  deploy:
    uses: SeuUsuario/vercel-rollback-workflows/.github/workflows/vercel-rollback.yml@v1.0.0
    with:
      # ‚¨áÔ∏è OBRIGAT√ìRIO: Nome do seu projeto no Vercel
      vercelProject: "gateway-pagamento-prod"
      
      # ‚¨áÔ∏è ROTAS CR√çTICAS PARA GATEWAY DE PAGAMENTO
      routes: "/,/api/health,/api/payment,/api/webhook,/api/status,/api/refund,/api/validate"
      
      # ‚¨áÔ∏è CONFIGURA√á√ïES M√ÅXIMA CONFIABILIDADE
      healthCheckTimeout: 90        # Timeout muito alto para opera√ß√µes financeiras
      maxRetries: 6                 # M√°ximo de tentativas para sistema cr√≠tico
      enablePostDeployMonitoring: true
      monitoringDurationMinutes: 90 # Monitoramento estendido (1.5 horas)
      monitoringIntervalMinutes: 2  # Verifica√ß√µes muito frequentes
      
    secrets:
      VERCEL_TOKEN: ${{ secrets.VERCEL_TOKEN }}
      VERCEL_TEAM_ID: ${{ secrets.VERCEL_TEAM_ID }}
      VERCEL_SCOPE: ${{ secrets.VERCEL_SCOPE }}

# ========================================
# ROTAS CR√çTICAS PARA GATEWAY DE PAGAMENTO
# ========================================
#
# APIs Ultra-Cr√≠ticas:
# /api/payment - Processamento de pagamentos (CR√çTICO)
# /api/webhook - Recebimento de notifica√ß√µes (CR√çTICO)
# /api/status - Status de transa√ß√µes (CR√çTICO)
# /api/refund - Sistema de estorno (CR√çTICO)
# /api/validate - Valida√ß√£o de dados (CR√çTICO)
# /api/health - Health check (OBRIGAT√ìRIO)
#
# P√°ginas de Suporte:
# / - Landing/documenta√ß√£o da API
# /docs - Documenta√ß√£o t√©cnica
# /status - Status page p√∫blico
#
# ========================================
# CONFIGURA√á√ïES ESPEC√çFICAS
# ========================================
#
# ULTRA-CONSERVADOR para sistemas financeiros:
# - Timeout alt√≠ssimo (90s) para opera√ß√µes complexas
# - M√°ximo de tentativas (6) para evitar falsos positivos
# - Monitoramento muito longo (90min) para detectar qualquer problema
# - Verifica√ß√µes muito frequentes (2min) para resposta imediata
#
# IMPORTANTE: Gateway de pagamento NUNCA pode ter downtime
# n√£o detectado. Melhor falso positivo que falha real.
#
# ========================================
